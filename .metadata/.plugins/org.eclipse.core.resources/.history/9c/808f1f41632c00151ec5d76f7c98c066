package filterjdbcdemo.db;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.sql.Statement;

import com.sun.xml.internal.fastinfoset.sax.Properties;

public class TestConn {

	private static String driver="com.microsoft.sqlserver.jdbc.SQLServerDriver";
	private static String url="jdbc:sqlserver://172.20.160.150";
	private static String user="enam";
	private static String password="enam123";
	
	private static TestConn tc;
	private Connection conn;
	
	private TestConn(){
		
		
	}
	
	static{
		
		try{
			
			Class.forName(driver);
			System.out.println("Driver loaded...");
		}
		catch(ClassNotFoundException e){
			
			e.printStackTrace();
		}
	}
	
	public Connection openConnection(){
		
		try {
			if(conn==null||conn.isClosed())
				conn=DriverManager.getConnection(url,user,password);
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		return conn;
	}
	
	public void closeConnection(){
		
		try {
			if(conn!=null&&!conn.isClosed())
				conn.close();
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		System.out.println("Connection closed...");
	}
	
	public static TestConn getInstance(){
		
		if(tc==null){
			tc=new TestConn();
		}
		return tc;
	}
	
	public static void main(String[] args) throws Exception{
	
		TestConn tc=TestConn.getInstance();
		Connection conn=tc.openConnection();
		System.out.println("Connection created...");
		Statement st=conn.createStatement();
		
		ResultSet rs=st.executeQuery("select * from trainers");
		ResultSetMetaData md=rs.getMetaData();
		
		for(int i=0;i<md.getColumnCount();i++){
			
			System.out.println(md.getColumnName(i+1)+" : "+md.getColumnTypeName(i+1));
		}
		
		/*String sql="select * from trainers where tid=?";
		//ResultSet rs=st.executeQuery("select * from trainers");
		PreparedStatement pst=conn.prepareStatement(sql);
		pst.setInt(1,10);
		ResultSet pstrs=pst.executeQuery();
		
		while(pstrs.next()){
			
			System.out.println(pstrs.getInt("tid")+","+pstrs.getString("name"));
		}
		pstrs.close();*/
		
		/*while(rs.next()){
			
			System.out.println(rs.getInt("tid")+","+rs.getString("name"));
		}
		rs.close();*/
		st.close();
		tc.closeConnection();
	}
}
